import{_ as p,r as a,o as c,c as i,a as n,b as s,d as t,e as l}from"./app-cbd08a8c.js";const u={},r=n("h1",{id:"利用钩子注入-js",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#利用钩子注入-js","aria-hidden":"true"},"#"),s(" 利用钩子注入 JS")],-1),d={href:"https://nuxtjs.org/api/configuration-hooks#list-of-hooks",target:"_blank",rel:"noopener noreferrer"},k=l(`<p>在本项目中，我的需求是生成静态页面需要的 JS。这个 JS 包含两个功能：</p><ol><li>初始化 swiper</li><li>启动统计代码</li></ol><p>因为功能非常简单，我暂时不打算用 webpack 打包，只想复制到目标文件夹里。启动复制操作的时机并不敏感，因为和主要的生成静态页工作不存在相互依赖的关系。不过 Nuxt.js 默认会清理生成目录，所以我觉得晚一些复制会比较好，最后选择 <code>generate:done</code> 这个钩子（基本是最后才会执行）。代码如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">promises</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    copyFile<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">hooks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">generate</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">async</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> from <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;src/footer.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> to <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;static/footer.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> <span class="token function">copyFile</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;[CMS : Nuxt] Static files copied.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),v=n("p",null,[s("这段代码应该很容易看懂吧，就是一个简单的复制。不过需要注意，"),n("code",null,"copyFile"),s(" 函数是 v10 之后添加到 Node.js 里的，而预 promise 化的 "),n("code",null,"fs.promises"),s(" 是 v12 之后添加的。")],-1);function m(_,f){const e=a("ExternalLinkIcon"),o=a("adsense");return c(),i("div",null,[r,n("p",null,[s("Nuxt.js 提供了很多钩子，方便我们在特定的环节进行定制化操作。这些钩子跟不同的操作绑定，接受不同的参数，返回不同的结果，具体钩子列表请参考 "),n("a",d,[s("Nuxt.js > API > Hooks > List of hooks"),t(e)]),s("。")]),k,t(o),v])}const h=p(u,[["render",m],["__file","inject-js.html.vue"]]);export{h as default};
